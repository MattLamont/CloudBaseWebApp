<div class="row">

  <!-- Recipe Base -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header">RECIPE BASE</div>
      <div class="card-body">

        <div class="form-row">
          <div class="form-group col-6">
            <label>Amount to Make</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="basicMixingInfo.totalVolume" (change)="recalculateRecipe()">
              <div class="input-group-addon">ml</div>
            </div>
          </div>
          <div class="form-group col-6">
            <label>Recipe Strength</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="basicMixingInfo.recipeStrength" (change)="recalculateRecipe()">
              <div class="input-group-addon">mg/ml</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-6">
            <label>Propylene Glycol (PG)</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="recipe.pg_percent" (ngModelChange)="onRecipePGChange($event)" min=0 max=100 [disabled]="isViewRecipe">
              <div class="input-group-addon">%</div>
            </div>
          </div>
          <div class="form-group col-6">
            <label>Vegetable Glycerin (VG)</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="recipe.vg_percent" (ngModelChange)="onRecipeVGChange($event)" min=0 max=100 [disabled]="isViewRecipe">
              <div class="input-group-addon">%</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <label>Dilutant</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="recipe.dilutant" (change)="onRecipeDilutantChange($event)" min=0 max=100>
              <div class="input-group-addon">%</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <label>Nicotine Strength</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="basicMixingInfo.nicotineStrength" (change)="recalculateRecipe()" min=0 max=100000>
              <div class="input-group-addon">mg/ml</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-6">
            <label>Nicotine PG</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="basicMixingInfo.nicotinePG" (change)="onNicotinePGChange()" min=0 max=100>
              <div class="input-group-addon">%</div>
            </div>
          </div>
          <div class="form-group col-6">
            <label>Nicotine VG</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="basicMixingInfo.nicotineVG" (change)="onNicotineVGChange()" min=0 max=100>
              <div class="input-group-addon">%</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <ngb-alert type="danger" *ngIf="recipeBaseErrorMessage" class="mt-3">{{ recipeBaseErrorMessage }}</ngb-alert>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- End Recipe Base -->

  <!-- Flavors List -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header">FLAVORS</div>
      <div class="card-body">
        <div class="form-row" *ngFor="let flavor of recipe.flavors; index as i">
          <div class="form-group col-xs-12 col-sm-8">
            <label>{{flavor.manufacturer}}</label>
            <input type="text" class="form-control" [showHint]="true" [editable]="false" [ngbTypeahead]="searchFlavor" [ngModel]="flavor" (selectItem)="flavorSelected($event,i)" placeholder="Flavor" [resultTemplate]="flavorTemplate" [inputFormatter]="formatter" [disabled]="isViewRecipe"
            />

            <ng-template #flavorTemplate let-r="result">
              [{{r.manufacturer}}] {{ r.name }}
            </ng-template>
          </div>

          <div class="form-group col-xs-12 col-sm-4" *ngIf="flavor.name">
            <label>Percent</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="recipe.flavor_percents[i]" (ngModelChange)="onFlavorPercentChange($event)" min=0 max=100 [disabled]="isViewRecipe">
              <div class="input-group-addon">%</div>
            </div>
          </div>

        </div>

        <div class="form-row" *ngIf="isCreateRecipe || isUpdateRecipe">
          <div class="form-group">
            <div class="col-12 mt-3">
              <button type="button" class="btn btn-primary" (click)="addAnotherFlavor()">Add A Flavor</button>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <ngb-alert type="danger" *ngIf="flavorErrorMessage" class="mt-3">{{ flavorErrorMessage }}</ngb-alert>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- End Flavors List -->

  <!-- Proportions Chart -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header">PROPORTIONS</div>
      <div class="card-body">
        <div>
          <ngx-charts-pie-chart class="chart-container" [scheme]="colorScheme" [(results)]="chartData" [legend]="false" [labels]="true" [doughnut]="true" [arcWidth]="0.25" [tooltipDisabled]="false">
          </ngx-charts-pie-chart>
        </div>
      </div>
    </div>
  </div>
  <!-- End Proportions Chart -->

  <!-- Mixing Guide -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header">MIXING GUIDE</div>
      <div class="card-body">
        <div class="no-more-tables">
          <table class="table table-striped mb-0">
            <thead class="thead-default">
              <tr>
                <th>
                  Item
                </th>
                <th>
                  Percent
                </th>
                <th class="numeric">
                  Milliliters
                </th>
                <!--
                <th class="numeric">
                  Grams
                </th>
                -->
              </tr>
            </thead>
            <tbody>
              <tr class="table-success">
                <td data-title="Item">
                  Propylene Glycol (PG)
                </td>
                <td data-title="Percent">
                  {{basicMixingInfo.pg.percent | number:'1.0-2'}}%
                </td>
                <td data-title="Milliliters" class="numeric">
                  {{basicMixingInfo.pg.ml | number:'1.0-2'}}ml
                </td>
                <!--
                <td data-title="Grams" class="numeric">
                  {{basicMixingInfo.pg.grams}}
                </td>
                -->
              </tr>
              <tr class="table-info">
                <td data-title="Item">
                  Vegetable Glycerin (VG)
                </td>
                <td data-title="Percent">
                  {{basicMixingInfo.vg.percent | number:'1.0-2'}}%
                </td>
                <td data-title="Milliliters" class="numeric">
                  {{basicMixingInfo.vg.ml | number:'1.0-2'}}ml
                </td>
                <!--
                <td data-title="Grams" class="numeric">
                  {{basicMixingInfo.vg.grams}}
                </td>
                -->
              </tr>
              <tr class="table-danger">
                <td data-title="Item">
                  Dilutant
                </td>
                <td data-title="Percent">
                  {{basicMixingInfo.dilutant.percent | number:'1.0-2'}}%
                </td>
                <td data-title="Milliliters" class="numeric">
                  {{basicMixingInfo.dilutant.ml | number:'1.0-2'}}ml
                </td>
                <!--
                <td data-title="Grams" class="numeric">
                  {{basicMixingInfo.vg.grams}}
                </td>
                -->
              </tr>
              <tr class="table-warning">
                <td data-title="Item">
                  Nicotine Solution
                </td>
                <td data-title="Percent">
                  {{basicMixingInfo.nicotine.percent | number:'1.0-2'}}%
                </td>
                <td data-title="Milliliters" class="numeric">
                  {{basicMixingInfo.nicotine.ml | number:'1.0-2'}}ml
                </td>
                <!--
                <td data-title="Grams" class="numeric">
                  {{basicMixingInfo.nicotine.grams}}
                </td>
                -->
              </tr>
              <tr *ngFor="let flavor of recipe.flavors; let i = index">
                <td data-title="Item" *ngIf="flavor.name">
                  {{flavor.name}}
                </td>
                <td data-title="Percent" *ngIf="flavor.name">
                  {{basicMixingInfo.flavors[i].percent | number:'1.0-2'}}%
                </td>
                <td data-title="Milliliters" class="numeric" *ngIf="flavor.name">
                  {{basicMixingInfo.flavors[i].ml | number:'1.0-2'}}ml
                </td>
                <!--
                <td data-title="Grams" class="numeric" *ngIf="flavor.name">
                  {{basicMixingInfo.flavors[i].grams}}
                </td>
                -->
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Info -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header">ADDITIONAL INFO</div>
      <div class="card-body">

        <div class="form-row">
          <div class="form-group col-12">
            <label>Name</label>
            <input class="form-control" type="text" [(ngModel)]="recipe.name" [disabled]="isViewRecipe">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <label>Category</label>
            <select class="form-control" [(ngModel)]="recipe.category" [disabled]="isViewRecipe">
            <option *ngFor="let category of categories">{{category}}</option>
          </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <label>Steep Time</label>
            <div class="input-group">
              <input class="form-control" type="number" [(ngModel)]="recipe.steep_time" [disabled]="isViewRecipe">
              <div class="input-group-addon">days</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-12">
            <label>Description</label>

            <div>
              <div class="toolbar" id="toolbar-toolbar">
                <span class="ql-formats">
                  <select class="ql-size">
                    <option value="small"></option>
                    <option selected=""></option>
                    <option value="large"></option>
                    <option value="huge"></option>
                  </select>
                </span>
                <span class="ql-formats">
                  <button class="ql-bold"></button>
                  <button class="ql-italic"></button>
                  <button class="ql-underline"></button>
                  <button class="ql-strike"></button>
                </span>
                <span class="ql-formats">
                  <select class="ql-color"></select>
                  <select class="ql-background"></select>
                </span>
                <span class="ql-formats">
                  <button class="ql-list" value="ordered"></button>
                  <button class="ql-list" value="bullet"></button>
                  <select class="ql-align">
                    <option selected=""></option>
                    <option value="center"></option>
                    <option value="right"></option>
                    <option value="justify"></option>
                  </select>
                </span>
                <span class="ql-formats">
                  <button class="ql-link"></button>
                </span>
              </div>

              <div id="editor-container">
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- End Additional Info -->

  <!-- Recipe Image Upload -->
  <div class="col-lg-6 col-xs-12" *ngIf="sessionUser">
    <div class="card">
      <div class="card-header">IMAGE</div>
      <div class="card-body">

        <!--
        <image-upload (uploadFinished)="imageUploaded($event)" [url]="imageUploadURL" [max]="1" [extensions]="['jpg','png','gif','jpeg']" [headers]="authHeaders" dropBoxMessage="Drop Images Here" buttonCaption="Select Image" (removed)="onImageRemoved($event)"
            *ngIf="isCreateRecipe || isUpdateRecipe">
        </image-upload>
        -->

        <div class="mb-2" *ngIf="isCreateRecipe || isUpdateRecipe">
          <label class="btn btn-primary btn-file">Upload Image
            <input id="custom-input" style="display:none;" type="file" (change)="fileChangeListener($event)" accept=".png, .jpg, .jpeg .gif">
          </label>
          <button class="btn btn-danger" *ngIf="imageCropperLoaded" (click)="cancelImageUpload()">Cancel</button>
        </div>

        <div #imageContainer>
          <div *ngIf="imageCropperLoaded">
            <img-cropper #cropper [image]="imageData" [settings]="cropperSettings"></img-cropper><br>
          </div>
        </div>

        <div *ngIf="recipe.image_url && !imageCropperLoaded" >
          <img src="{{recipe.image_url}}" class="img-fluid" />
        </div>

      </div>
    </div>
  </div>
  <!-- End Recipe Image Upload -->

  <!-- Submit Area -->
  <div class="col-lg-6 col-xs-12">
    <div class="card">
      <div class="card-header" *ngIf="isCreateRecipe || isUpdateRecipe">SUBMIT</div>
      <div class="card-header" *ngIf="isViewRecipe">OPTIONS</div>
      <div class="card-body">
        <!-- Private / Public Recipe option
        <div class="form-row" *ngIf="isCreateRecipe || isUpdateRecipe">
          <div class="form-group col-12">
            <p class="mb-2">Recipe Privacy</p>
            <label class="custom-control custom-checkbox">
              <input id="radio1" name="radio" type="radio" class="custom-control-input" [checked]="recipe.isPrivate" (change)="recipe.isPrivate = !recipe.isPrivate">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Private</span>
            </label>
            <label class="custom-control custom-checkbox">
              <input id="radio2" name="radio" type="radio" class="custom-control-input" [checked]="!recipe.isPrivate" (change)="recipe.isPrivate = !recipe.isPrivate">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Public</span>
            </label>
          </div>
        </div>
        -->
        <div class="form-row">
          <div class="form-group">
            <div class="col-12 mt-3" *ngIf="isCreateRecipe">
              <button type="button" class="btn btn-primary" [disabled]="recipeBaseErrorMessage && flavorErrorMessage" (click)="submitNewRecipe()">Submit New Recipe</button>
            </div>
            <div class="col-12 mt-3" *ngIf="isUpdateRecipe">
              <button type="button" class="btn btn-primary" [disabled]="recipeBaseErrorMessage && flavorErrorMessage" (click)="updateRecipe()">Update Recipe</button>
            </div>
            <div class="col-12 mt-3" *ngIf="isViewRecipe">
              <a href="{{'/recipe/'+recipe.id}}">
                <button type="button" class="btn btn-success">View Recipe Page</button>
              </a>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-12">
            <ngb-alert [type]="submitErrorMessageType" *ngIf="submitErrorMessage" (close)="submitErrorMessage = ''" class="mt-3">{{ submitErrorMessage }}</ngb-alert>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Submit Area -->

</div>
